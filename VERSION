V422

Release Date: 2025-01-30

Bug Fix: Movement Synchronization (Receive targetX/targetZ from Server)

Fixed critical bug where characters showed running animation but didn't actually move (running in place).
Client now receives targetX/targetZ from server to know where players are trying to move.

Root Cause:
- Server's broadcastGameState() only sent current position (x, z) and isMoving flag
- Server did NOT send target position (targetX, targetZ)
- Client received current position but didn't know where player was trying to move to
- Client's local targetX/targetZ remained unchanged while server position was updated
- Result: Character mesh showed at server position but tried to move to old local target
- This caused running-in-place animation

Changes:
- Client now receives targetX/targetZ from server in serverGameState event
- For SELF: Apply server's targetX/targetZ and isMoving to align with server's movement goal
- For OPPONENT: Apply server's x/z/targetX/targetZ/isMoving for full server authority
- Position error reconciliation (threshold 25) still applies for self to handle prediction errors
- updatePlayerMovement() now interpolates toward server-provided target, not stale local target

Previous Fixes (V420):
- Fixed spawn position bug (team type coercion)
- Fixed missing hit effects (always show blood/audio)
- Fixed latency regression (removed high-frequency logs)

Note: Map boundary restrictions remain client-side only (isWithinMapBounds in game3d.js)

Previous Fixes (V418):

Changes:
- Modified updatePlayerMovement() to skip client-side interpolation for opponent in multiplayer
- Server now sends authoritative position updates at 20Hz via serverGameState event
- Opponent position is now driven entirely by server updates (no client-side prediction)
- This ensures both players see consistent movement for all characters

Previous Fixes (V417):

Issue 1: Start Game Button Not Showing
Root Cause:
- updateStartButtonState() was using old isReady/opponentReady variables
- New team-based system stores ready status in currentRoomState.players[socketId].ready
- Function wasn't checking roomState, causing button to never show

Changes:
- Rewrote updateStartButtonState() to use currentRoomState instead of legacy variables
- Added proper host detection using currentRoomState.hostSocket === socket.id
- Added team capacity checks (1v1: 1 per team, 3v3: 1+ per team)
- Added comprehensive debugging logs with [START-CHECK] prefix
- Button now correctly shows when: all players ready + both teams filled + game not started

Issue 2: Host Disconnect Not Handled
Root Cause:
- When host closed browser, guests remained in room with no way to start game
- No notification sent to remaining players

Changes:
- Added hostDisconnected event handler
- When host disconnects, all players receive alert: "Host has left the room. Room is now closed."
- Players automatically return to main menu
- Room is deleted from server

Previous Fixes (V415):
- Fixed handleTeamSelect() to allow first-time team selection in 1v1 mode
- Only blocks team switching after player is already assigned to a team
- Added comprehensive debugging logs to track team selection flow
